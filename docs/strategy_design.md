# 策略設計文檔

## 概述

本專案實現了四種基於技術指標的量化交易策略，每種策略都結合了移動平均線和威廉指標，並使用固定停損機制來控制風險。

## 策略架構

### 技術指標

1. **移動平均線 (Moving Average)**
   - 短期移動平均線：用於捕捉短期趨勢
   - 長期移動平均線：用於確認長期趨勢
   - 黃金交叉：短期均線上穿長期均線，視為買進信號
   - 死亡交叉：短期均線下穿長期均線，視為賣出信號

2. **威廉指標 (Williams %R)**
   - 用於判斷超買超賣狀態
   - 買進信號：指標值 < 閾值（通常為 -50 到 -80）
   - 賣出信號：指標值 > 閾值（通常為 -20 到 -50）

3. **停損機制**
   - 固定比例停損：當虧損達到進場價格的一定比例時自動出場
   - 用於控制下行風險

## 四種策略

### 策略 1：均線買 + 均線賣

**進場條件：**
- 短期均線上穿長期均線（黃金交叉）
- AND 威廉指標超賣（指標值 < 買進閾值）

**出場條件：**
- 短期均線下穿長期均線（死亡交叉）
- OR 威廉指標超買（指標值 > 賣出閾值）
- OR 觸發停損

**特點：**
- 趨勢跟隨型策略
- 適合趨勢明確的市場
- 可能錯過快速反轉的機會

### 策略 2：均線買 + 價格賣

**進場條件：**
- 短期均線上穿長期均線（黃金交叉）
- AND 威廉指標超賣（指標值 < 買進閾值）

**出場條件：**
- 價格跌破長期均線
- OR 威廉指標超買（指標值 > 賣出閾值）
- OR 觸發停損

**特點：**
- 結合趨勢和價格突破
- 出場更靈活，可能提前獲利了結
- 適合波動較大的市場

### 策略 3：價格買 + 均線賣

**進場條件：**
- 價格突破短期均線
- AND 威廉指標超賣（指標值 < 買進閾值）

**出場條件：**
- 短期均線下穿長期均線（死亡交叉）
- OR 威廉指標超買（指標值 > 賣出閾值）
- OR 觸發停損

**特點：**
- 價格突破型策略
- 進場更靈活，可能捕捉到更好的進場點
- 適合震盪市場

### 策略 4：價格買 + 價格賣

**進場條件：**
- 價格突破短期均線
- AND 威廉指標超賣（指標值 < 買進閾值）

**出場條件：**
- 價格跌破長期均線
- OR 威廉指標超買（指標值 > 賣出閾值）
- OR 觸發停損

**特點：**
- 純價格突破策略
- 進出場都基於價格與均線的關係
- 最靈活的策略，但也可能產生較多假信號

## 參數設定

### 移動平均線參數
- 短期均線週期：15-35 期
- 長期均線週期：20-60 期
- 限制：短期均線週期 < 長期均線週期

### 威廉指標參數
- 買進信號週期：20-60 期
- 賣出信號週期：20-60 期
- 買進閾值：-80 到 -50
- 賣出閾值：-50 到 -20

### 停損參數
- 停損比例：0.2% - 0.4%
- 基於進場價格計算

## 交易邏輯

### 進場邏輯
1. 檢查是否已有持倉
2. 計算技術指標
3. 檢查進場條件
4. 如果滿足條件，以下一根 K 線的開盤價進場
5. 記錄進場資訊

### 出場邏輯
1. 檢查停損條件
2. 檢查技術指標出場條件
3. 如果滿足任一條件，以下一根 K 線的開盤價出場
4. 計算交易損益
5. 記錄出場資訊

### 風險控制
1. 固定停損：控制單筆交易的最大虧損
2. 技術指標過濾：減少假信號
3. 交易記錄：追蹤每筆交易的詳細資訊

## 績效評估

### 主要指標
- **勝率**：獲利交易數 / 總交易數
- **穩健夏普比率 (MSR)**：基於中位數和 MAD 的風險調整報酬
- **夏普比率**：基於均值和標準差的風險調整報酬
- **最大回撤**：最大累積虧損
- **獲利因子**：總獲利 / 總虧損

### 輔助指標
- **交易次數**：總交易筆數
- **平均持倉時間**：平均每筆交易的持倉 K 棒數
- **出場原因統計**：分析不同出場原因的頻率
- **回報分佈統計**：分析回報的分佈特徵

## 優化方法

### 網格搜索
- 測試所有參數組合
- 篩選條件：交易次數 > 20, 勝率 > 0.3, 最終資金 > 100 萬
- 按穩健夏普比率排序

### 貝葉斯優化
- 使用高斯過程優化
- 目標函數：穩健夏普比率
- 更高效的參數搜索

## 注意事項

1. **過擬合風險**：避免在驗證集上過度優化
2. **樣本外測試**：使用測試集驗證策略穩定性
3. **交易成本**：考慮手續費和滑點
4. **市場變化**：定期重新評估策略表現
5. **風險管理**：實盤交易需要更嚴格的風險控制 