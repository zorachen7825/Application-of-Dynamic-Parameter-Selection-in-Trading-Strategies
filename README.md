# 動態參數選擇在交易策略中的應用

## 專案簡介

本專案源自碩士論文《動態參數選擇在交易策略中的應用：基於 XGBoost 控制層的實證分析》，專案針對**台灣加權指數期貨（大台期貨）**進行回測，使用 15 分鐘 K 線資料（2021/12/01–2025/03/07，共 15,714 筆）。
設計四種結合移動平均線（MA）與威廉指標（Williams %R）的技術策略，並提出XGBoost 控制層以動態選擇參數，提升策略適應性與穩健性。

專案實作包含：
1. 三種參數優化方法：網格搜尋、貝葉斯優化、蒙地卡羅模擬
2. 回測與績效評估框架
3. 可解釋的 XGBoost 模型控制層

回測結果顯示，XGBoost 控制層在驗證集的成果：
- 勝率：0.6327
- MSR：0.4098

表現優於最佳靜態策略（勝率 0.4722，MSR -0.2051），唯最大回撤仍有改善空間。


## 策略概述
所有策略均為多頭交易（Long-Only），每筆交易固定一張合約，初始資金 100 萬台幣。交易成本：每點 200 台幣，手續費率 0.02%。進場在下一根 K 線開盤價執行。

### 策略 1：
- **進場條件**：短期 MA 上穿長期 MA 且 Williams %R 低於超賣閾值。
- **出場條件**：短期 MA 下穿長期 MA（死亡交叉）或 Williams %R 高於超買閾值或觸發停損。

### 策略 2：
- **進場條件**：短期 MA 上穿長期 MA 且 Williams %R 低於超賣閾值。
- **出場條件**：收盤價跌破長期 MA 或 Williams %R 高於超買閾值或觸發停損。

### 策略 3：
- **進場條件**：收盤價突破短期 MA 且 Williams %R 低於超賣閾值。
- **出場條件**：短期 MA 下穿長期 MA 或 Williams %R 高於超買閾值或觸發停損。

### 策略 4：
- **進場條件**：收盤價突破短期 MA 且 Williams %R 低於超賣閾值。
- **出場條件**：收盤價跌破長期 MA 或 Williams %R 高於超買閾值或觸發停損。

## 技術指標

### 移動平均線 (MA)
- 短期 MA 週期：15-35（整數）
- 長期 MA 週期：20-60（整數，需大於短期 MA）

### 威廉指標 (Williams %R)
- 買進信號週期：20-60（整數）
- 賣出信號週期：20-60（整數）
- 買進閾值：-80 到 -50（整數）
- 賣出閾值：-50 到 -20（整數）

### 停損機制
- 固定停損比例：0.002-0.004（浮點數）

### 停損機制
- 從 60 組候選參數中動態選擇最佳組合。
- 輸入特徵：基於 K 線的二元矩陣（是否屬於盈利交易期）。
- 標籤：累計利潤 > 22,000 台幣為 1，否則為 0。
- 使用 SHAP 值分析特徵重要性。

## 檔案結構

```
論文/
├── README.md                     # 專案說明文件
├── requirements.txt              # Python 套件依賴
├── data/
│   └── full_15K.csv              # 歷史價格數據
├── src/
│   ├── __init__.py
│   ├── data_loader.py            # 數據載入與預處理
│   ├── indicators.py             # 技術指標計算
│   ├── strategies.py             # 交易策略實作
│   ├── backtest.py               # 回測引擎
│   ├── optimization.py           # 參數優化
│   └── evaluation.py             # 績效評估
├── notebooks/
│   ├── 01_data_exploration.ipynb
│   ├── 02_strategy_backtest.ipynb
│   ├── 03_parameter_optimization.ipynb
│   └── 04_results_analysis.ipynb
├── results/
│   ├── grid_search_results.json
│   ├── bayesian_optimization_results.json
│   └── performance_metrics.json
└── docs/
    ├── strategy_design.md
    ├── optimization_methods.md
    └── results_analysis.md
```

## 安裝與使用

### 環境需求
- Python 3.8+
- 相關套件見 `requirements.txt`

### 安裝步驟
```bash
# 克隆專案
git clone <repository-url>
cd gork-trading-strategy

# 安裝依賴
pip install -r requirements.txt

# 執行回測
python src/backtest.py

# 執行參數優化
python src/optimization.py
```

## 主要功能

### 1. 數據處理
- 載入歷史價格數據
- 數據清洗與預處理
- 技術指標計算

### 2. 策略回測
- 四種交易策略實作
- 滑動窗口回測
- 交易記錄與績效計算

### 3. 參數優化
- 網格搜索：評估所有組合
- 貝葉斯優化：：100 次迭代，初始 10 組隨機樣本
- 蒙地卡羅優化：隨機抽樣 1000 組

### 4. 濾網
篩選條件如下：
- 交易次數 > 20
- 勝率 > 0.3
- 最終資金 > 100 萬
- 5 筆最長持倉時間平均 > 3 根K棒
成果依 MSR 作為排序依據。

### 5. 績效評估
- 勝率、MSR、中位數回報、最大回撤
- 交易持續時間分析、出場原因統計

## 優化結果

### XGBoost 控制層（測試集）：

交易次數：49
最終資金：1,181,105 台幣
勝率：0.6377
MSR：0.4088
比較：優於靜態參數（勝率 0.4722，MSR -0.2515）。
## 研究發現

1. 策略 1 表現最佳：均線交叉信號在趨勢捕捉上穩定。
2. 動態參數優於靜態：XGBoost 提升適應性，但風險控制有改善空間
3. 限制：數據僅限台股期貨，忽略夜盤和複利效應。
4. 未來方向：整合更多特徵（如成交量）、測試其他市場、強化停損機制。

## 注意事項

- 本專案僅供研究使用，不構成投資建議
- 專案不考慮滑點、市場衝擊或結構性變化

## 貢獻指南

歡迎提交 Issue 和 Pull Request 來改善這個專案。

## 授權

本專案採用 MIT 授權條款。

## 聯絡資訊

如有問題或建議，請透過 GitHub Issues 聯絡。 
